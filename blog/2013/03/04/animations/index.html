
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Animations - 小桑博客</title>
  <meta name="author" content="alfred sang">

  
  <meta name="description" content="Animations Animations
Manual Animation
Sprite Sheet Animation
Creating from .png and .plist file
File animation
Skeleton Animation
Comment Manual &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://shiren1118.github.com/blog/2013/03/04/animations/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="小桑博客" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">小桑博客</a></h1>
  
    <h2>如果渡不过这不可渡的海，将成为这海中捞不起的沙</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:shiren1118.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">博客</a></li>
  <li><a href="/blog/archives">归档</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Animations</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-04T16:57:00+08:00" pubdate data-updated="true">Mar 4<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Animations</h2>

<p>Animations
Manual Animation
Sprite Sheet Animation
Creating from .png and .plist file
File animation
Skeleton Animation
Comment</p>

<h3>Manual Animation</h3>

<p>You can create an animation from a series of image file, like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'> <span class="mi">1</span><span class="n">CCAnimation</span> <span class="o">*</span><span class="n">animation</span> <span class="o">=</span> <span class="n">CCAnimation</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
</span><span class='line'> <span class="mi">2</span>
</span><span class='line'> <span class="mi">3</span><span class="c1">// load image file from local file system to CCSpriteFrame, then add into CCAnimation</span>
</span><span class='line'> <span class="mf">4f</span><span class="n">or</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'> <span class="mi">5</span><span class="p">{</span>
</span><span class='line'> <span class="mi">6</span>    <span class="kt">char</span> <span class="n">szImageFileName</span><span class="p">[</span><span class="mi">128</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span class='line'> <span class="mi">7</span>    <span class="n">sprintf</span><span class="p">(</span><span class="n">szImageFileName</span><span class="p">,</span> <span class="s">&quot;Images/grossini_dance_%02d.png&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'> <span class="mi">8</span>    <span class="n">animation</span><span class="o">-&gt;</span><span class="n">addSpriteFrameWithFileName</span><span class="p">(</span><span class="n">szImageFileName</span><span class="p">);</span>
</span><span class='line'> <span class="mi">9</span><span class="p">}</span>
</span><span class='line'><span class="mi">10</span>
</span><span class='line'><span class="mi">11</span><span class="n">animation</span><span class="o">-&gt;</span><span class="n">setDelayPerUnit</span><span class="p">(</span><span class="mf">2.8f</span> <span class="o">/</span> <span class="mf">14.0f</span><span class="p">);</span> <span class="c1">// This animation contains 14 frames, will continuous 2.8 seconds.</span>
</span><span class='line'><span class="mi">12</span><span class="n">animation</span><span class="o">-&gt;</span><span class="n">setRestoreOriginalFrame</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">// Return to the 1st frame after the 14th frame is played. </span>
</span><span class='line'><span class="mi">13</span>
</span><span class='line'><span class="mi">14</span><span class="n">CCAnimate</span> <span class="o">*</span><span class="n">action</span> <span class="o">=</span> <span class="n">CCAnimate</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">animation</span><span class="p">);</span>
</span><span class='line'><span class="mi">15</span><span class="n">sprite</span><span class="o">-&gt;</span><span class="n">runAction</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>  <span class="c1">// run action on sprite object</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that CCAnimation is composed by sprite frames, delay time per frame, durations etc, it&#8217;s a pack of &#8220;data&#8221;. While CCAnimate is an action, which is created base on CCAnimation object.</p>

<h3>Sprite Sheet Animation</h3>

<p>Although manual animation is very easy to understand, it&#8217;s rarely used in real game projects. Instead, sprite sheet animation is the common solution of 2D animations.</p>

<p>This is a typical sprite sheet. It can be a sequence of sprite frames for an animation, or can be images pack that will be used in a same scene.</p>

<p><img src="http://www.cocos2d-x.org/attachments/download/1570" alt="" /></p>

<p>In OpenGL ES 1.1 period, sprite sheets was widely used for these benefits:
Reduce times of file I/O. Loading a big sprite sheet file is faster than loading lots of small files.
Reduce the memory consumption. OpenGL ES 1.1 can only use power-of-two sized textures (that is a width or height of 2,4,864,128,256,512,1024,&#8230;). In other words, OpenGL ES 1.1 allocates power-of-two sized memory for each texture even if this texture has smaller width and height. So using packed sprite sheet image will reduce the fragments of memory.
Reduce the draw calls to OpenGL ES draw method and speed up rendering.
Cocos2d-x v2.0 upgraded to OpenGL ES 2.0 based. OpenGL ES 2.0 doesn&#8217;t allocate power-of-two memory block for textures anymore, but the benefit of reducing file I/O times and draw calls are still working.</p>

<p>Then how about the animation? As we can see, sprite sheet has no MUST-BE relationship with animations. But considering to these benefits above, sprite sheet animations are efficient. There&#8217;re different ways to create sprite sheet animations in cocos2d.</p>

<h4>Creating from .png and .plist file</h4>

<p>In cocos2d-x 0.x and 1.x versions, CCSpriteSheet works for this purpose. While CCSpriteBatchNode is a replacement of CCSpriteSheet since v2.0</p>

<p>A CCSpriteBatchNode object contains the actual image texture of all the sprite frames. You must add it to a scene, even though it won&#8217;t draw anything itself; it just needs to be there so that it is part of the rendering pipeline. For example:</p>

<p>1CCSpriteBatchNode* spritebatch = CCSpriteBatchNode::create(&#8220;animations/grossini.png&#8221;);
Next, you need to use the CCSpriteFrameCache singleton to keep track how frame names correspond to frame bounds – that is, what rectangular area of the sprite sheet. Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="mi">1</span><span class="n">CCSpriteFrameCache</span><span class="o">*</span> <span class="n">cache</span> <span class="o">=</span> <span class="n">CCSpriteFrameCache</span><span class="o">::</span><span class="n">sharedSpriteFrameCache</span><span class="p">();</span>
</span><span class='line'><span class="mi">2</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">addSpriteFramesWithFile</span><span class="p">(</span><span class="s">&quot;animations/grossini.plist&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once your sprite sheet and frames are loaded, and the sprite sheet has been added to the scene, you can create sprites that use these frames by using the “createWithSpriteFrameName” method, and adding it as a child of the sprite sheet:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="mi">1</span><span class="n">m_pSprite1</span> <span class="o">=</span> <span class="n">CCSprite</span><span class="o">::</span><span class="n">createWithSpriteFrameName</span><span class="p">(</span><span class="s">&quot;grossini_dance_01.png&quot;</span><span class="p">);</span>
</span><span class='line'><span class="mi">2</span><span class="n">spritebatch</span><span class="o">-&gt;</span><span class="n">addChild</span><span class="p">(</span><span class="n">m_pSprite1</span><span class="p">);</span>
</span><span class='line'><span class="mi">3</span><span class="n">addChild</span><span class="p">(</span><span class="n">spritebatch</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>createWithSpriteFrameName method will find the corresponding coordinates and rectangle from grossini.plist, then &#8220;clip&#8221; the texture grossini.png to a sprite frame.
Now we need to create a CCArray object and add all frames of the animation to it. In the case of this animation, we know all 14 frames have the same size, so we can use a nested loop to iterate through them all, and break the loop when we finish adding the 14th frame.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'> <span class="mi">1</span><span class="n">CCArray</span><span class="o">*</span> <span class="n">animFrames</span> <span class="o">=</span> <span class="n">CCArray</span><span class="o">::</span><span class="n">createWithCapacity</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</span><span class='line'> <span class="mi">2</span>
</span><span class='line'> <span class="mi">3</span><span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span><span class='line'> <span class="mi">4</span>
</span><span class='line'> <span class="mf">5f</span><span class="n">or</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'> <span class="mi">6</span><span class="p">{</span>
</span><span class='line'> <span class="mi">7</span>    <span class="n">sprintf</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s">&quot;grossini_dance_%02d.png&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'> <span class="mi">8</span>    <span class="n">CCSpriteFrame</span><span class="o">*</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">cache</span><span class="o">-&gt;</span><span class="n">spriteFrameByName</span><span class="p">(</span> <span class="n">str</span> <span class="p">);</span>
</span><span class='line'> <span class="mi">9</span>    <span class="n">animFrames</span><span class="o">-&gt;</span><span class="n">addObject</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
</span><span class='line'><span class="mi">10</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we need to create a CCAnimate action instance which we can run on the CCSprite. Below, we also wrap the CCAnimate action in a CCRepeatForever action that does what you would expect: repeats the animation forever,like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="mi">1</span><span class="n">CCAnimation</span><span class="o">*</span> <span class="n">animation</span> <span class="o">=</span> <span class="n">CCAnimation</span><span class="o">::</span><span class="n">createWithSpriteFrames</span><span class="p">(</span><span class="n">animFrames</span><span class="p">,</span> <span class="mf">0.3f</span><span class="p">);</span>
</span><span class='line'><span class="mi">2</span><span class="n">m_pSprite1</span><span class="o">-&gt;</span><span class="n">runAction</span><span class="p">(</span> <span class="n">CCRepeatForever</span><span class="o">::</span><span class="n">create</span><span class="p">(</span> <span class="n">CCAnimate</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">animation</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>File animation</h4>

<p>CCAnimationCache can load a xml/plist file which well describes the batch node, sprite frame names and their rectangles. The interfaces are much easier to use.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="mi">1</span><span class="n">CCAnimationCache</span> <span class="o">*</span><span class="n">cache</span> <span class="o">=</span> <span class="n">CCAnimationCache</span><span class="o">::</span><span class="n">sharedAnimationCache</span><span class="p">();</span> <span class="c1">// &quot;caches&quot; are always singletons in cocos2d</span>
</span><span class='line'><span class="mi">2</span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">addAnimationsWithFile</span><span class="p">(</span><span class="s">&quot;animations/animations-2.plist&quot;</span><span class="p">);</span>
</span><span class='line'><span class="mi">3</span><span class="n">CCAnimation</span> <span class="n">animation</span> <span class="o">=</span> <span class="n">cache</span><span class="o">-&gt;</span><span class="n">animationByName</span><span class="p">(</span><span class="s">&quot;dance_1&quot;</span><span class="p">);</span>  <span class="c1">// I apologize for this method name, it should be getAnimationByName(..) in future versions</span>
</span><span class='line'><span class="mi">4</span><span class="n">CCAnimate</span> <span class="n">animate</span> <span class="o">=</span> <span class="n">CCAnimate</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">animation</span><span class="p">);</span>  <span class="c1">// Don&#39;t confused between CCAnimation and CCAnimate :)</span>
</span><span class='line'><span class="mi">5</span><span class="n">sprite</span><span class="o">-&gt;</span><span class="n">runAction</span><span class="p">(</span><span class="n">animate</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Easy to use, isn&#8217;t it?</p>

<h3>Skeleton Animation</h3>

<p>Please refer to <a href="http://www.cocos2d-x.org/projects/cocos2d-x/wiki/Skeletal_Animation">Skeletal Animation</a> page.</p>

<h3>Coment</h3>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">alfred sang</span></span>

      








  


<time datetime="2013-03-04T16:57:00+08:00" pubdate data-updated="true">Mar 4<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://shiren1118.github.com/blog/2013/03/04/animations/" data-via="" data-counturl="http://shiren1118.github.com/blog/2013/03/04/animations/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/03/04/actions/" title="Previous Post: Actions">&laquo; Actions</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/03/04/scheduler-and-timer-callback/" title="Next Post: Scheduler and Timer Callback">Scheduler and Timer Callback &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/04/transitions/">Transitions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/04/particles/">Particles</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/04/effects/">Effects</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/04/skeletal-animation/">Skeletal animation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/04/scheduler-and-timer-callback/">Scheduler and Timer Callback</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - alfred sang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'shiren1118';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://shiren1118.github.com/blog/2013/03/04/animations/';
        var disqus_url = 'http://shiren1118.github.com/blog/2013/03/04/animations/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
